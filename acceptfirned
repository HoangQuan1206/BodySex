-- ===============================
-- Auto Accept Friend + HUD VN Clock (Config + Info nÃ¢ng cao)
-- ===============================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- XoÃ¡ panel cÅ© náº¿u cÃ³
if PlayerGui:FindFirstChild("VN_Info_HUD") then
    PlayerGui.VN_Info_HUD:Destroy()
end

-- ===============================
-- Config lÆ°u tráº¡ng thÃ¡i
-- ===============================
local CONFIG_FILE = "AutoAcceptFriendConfig.json"
local HttpService = game:GetService("HttpService")

local function loadConfig()
    if isfile and isfile(CONFIG_FILE) then
        local success, data = pcall(function()
            return HttpService:JSONDecode(readfile(CONFIG_FILE))
        end)
        if success and data and data.AutoAcceptEnabled ~= nil then
            return data
        end
    end
    return { AutoAcceptEnabled = true }
end

local function saveConfig(data)
    if writefile then
        writefile(CONFIG_FILE, HttpService:JSONEncode(data))
    end
end

local config = loadConfig()
local AutoAcceptEnabled = config.AutoAcceptEnabled
local MAX_FRIENDS = 200

-- ===============================
-- HÃ m auto accept
-- ===============================
local function acceptFriendRequest(player)
    if not AutoAcceptEnabled then return end
    if not player or player == LocalPlayer then return end

    if #LocalPlayer:GetFriendsOnline() >= MAX_FRIENDS then
        alertLabel.Text = "âš ï¸ Friend list full (200/200)"
        warn("[FriendSystem] ÄÃ£ Ä‘á»§ " .. MAX_FRIENDS .. " báº¡n, dá»«ng auto.")
        return
    end

    pcall(function()
        LocalPlayer:RequestFriendship(player)
        player:RequestFriendship(LocalPlayer)
        alertLabel.Text = "âœ… Added friend: " .. player.Name
        print("[FriendSystem] Accepted:", player.Name)
        task.delay(3, function() alertLabel.Text = "" end)
    end)
end

-- Event ngÆ°á»i má»›i vÃ o
Players.PlayerAdded:Connect(acceptFriendRequest)
for _, player in pairs(Players:GetPlayers()) do
    acceptFriendRequest(player)
end

-- ===============================
-- UI HUD
-- ===============================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "VN_Info_HUD"
screenGui.Parent = PlayerGui
screenGui.ResetOnSpawn = false

-- Khung ná»n
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 280, 0, 190)
frame.Position = UDim2.new(1, -290, 0, 10)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

-- HÃ m táº¡o label
local function createLabel(yPos, text, size, color, bold)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -10, 0, 20)
    label.Position = UDim2.new(0, 5, 0, yPos)
    label.BackgroundTransparency = 1
    label.TextColor3 = color
    label.TextStrokeTransparency = 0.6
    label.Font = bold and Enum.Font.SourceSansBold or Enum.Font.SourceSans
    label.TextSize = size
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Text = text
    label.Parent = frame
    return label
end

-- Labels
local clockLabel = createLabel(5, "â° VN: --:--:--", 20, Color3.fromRGB(255, 255, 255), true)
local dateLabel = createLabel(30, "ðŸ“… --/--/----", 18, Color3.fromRGB(180, 220, 255))
local nameLabel = createLabel(50, "ðŸ‘¤ User: " .. LocalPlayer.DisplayName .. "(@".. LocalPlayer.Name..")", 16, Color3.fromRGB(255, 215, 0))
local levelLabel = createLabel(70, "ðŸ“ˆ Level: --", 16, Color3.fromRGB(200, 200, 255))
local serverLabel = createLabel(90, "ðŸŽ® Sea: ??? | ðŸ¤¼ Players: --", 16, Color3.fromRGB(150, 255, 150))
local perfLabel = createLabel(110, "âš¡ FPS: -- | ðŸ“¡ Ping: --", 16, Color3.fromRGB(255, 200, 0))
local friendCountLabel = createLabel(130, "ðŸ¤ Friends: --/200", 16, Color3.fromRGB(0, 200, 255))
local alertLabel = createLabel(150, "", 16, Color3.fromRGB(255, 100, 100), true)

-- NÃºt ON/OFF Auto Accept
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 260, 0, 25)
button.Position = UDim2.new(0, 10, 0, 165)
button.TextSize = 16
button.Font = Enum.Font.SourceSansBold
button.Parent = frame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 8)
btnCorner.Parent = button

local function updateButton()
    if AutoAcceptEnabled then
        button.Text = "ðŸ¤ Auto Accept Friend: ON"
        button.BackgroundColor3 = Color3.fromRGB(40, 150, 40)
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.BorderColor3 = Color3.fromRGB(0, 255, 0)
    else
        button.Text = "ðŸ¤ Auto Accept Friend: OFF"
        button.BackgroundColor3 = Color3.fromRGB(150, 40, 40)
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.BorderColor3 = Color3.fromRGB(255, 0, 0)
    end
end
updateButton()

button.MouseButton1Click:Connect(function()
    AutoAcceptEnabled = not AutoAcceptEnabled
    config.AutoAcceptEnabled = AutoAcceptEnabled
    saveConfig(config)
    updateButton()
    print("[FriendSystem] Auto Accept:", AutoAcceptEnabled and "ON" or "OFF")
end)

-- ===============================
-- HÃ m láº¥y Sea theo PlaceId
-- ===============================
local function getSea()
    local placeId = game.PlaceId
    if placeId == 2753915549 then return "First"
    elseif placeId == 4442272183 then return "Second"
    elseif placeId == 7449423635 then return "Third"
    else return "Unknown" end
end

-- ===============================
-- Update Clock + Info
-- ===============================
task.spawn(function()
    while task.wait(1) do
        local now = os.date("!*t")
        local vnHour = (now.hour + 7) % 24
        clockLabel.Text = "â° VN: " .. string.format("%02d:%02d:%02d", vnHour, now.min, now.sec)
        dateLabel.Text = "ðŸ“… " .. string.format("%02d/%02d/%04d", now.day, now.month, now.year)

        -- level (náº¿u cÃ³)
        local leaderstats = LocalPlayer:FindFirstChild("leaderstats")
        if leaderstats and leaderstats:FindFirstChild("Level") then
            levelLabel.Text = "ðŸ“ˆ Level: " .. leaderstats.Level.Value
        end

        serverLabel.Text = "ðŸŽ® " .. getSea() .. " | ðŸ¤¼ Players: " .. tostring(#Players:GetPlayers())
        friendCountLabel.Text = "ðŸ¤ Friends: " .. tostring(#Players:GetPlayers()) .. "/"..MAX_FRIENDS
    end
end)

-- ===============================
-- Update FPS + Ping
-- ===============================
local fps, lastUpdate = 0, tick()
RunService.RenderStepped:Connect(function()
    fps += 1
    if tick() - lastUpdate >= 1 then
        local ping = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString()
        perfLabel.Text = "âš¡ FPS: " .. fps .. " | ðŸ“¡ Ping: " .. ping
        fps, lastUpdate = 0, tick()
    end
end)

-- ===============================
-- PhÃ­m táº¯t áº©n/hiá»‡n HUD (F4)
-- ===============================
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.F4 then
        frame.Visible = not frame.Visible
    end
end)
