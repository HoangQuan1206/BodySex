-- ===============================
-- HUD VN (gọn đẹp, settings tối ưu)
-- ===============================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Xóa HUD cũ
if PlayerGui:FindFirstChild("VN_Info_HUD") then
    PlayerGui.VN_Info_HUD:Destroy()
end

-- ===============================
-- Config (chỉ lưu AutoAccept)
-- ===============================
local CONFIG_FILE = "VN_HUD_Config.json"
local function loadConfig()
    if isfile and isfile(CONFIG_FILE) then
        local ok, data = pcall(function() return HttpService:JSONDecode(readfile(CONFIG_FILE)) end)
        if ok and data then return data end
    end
    return {AutoAcceptEnabled = true}
end
local function saveConfig(data)
    if writefile then writefile(CONFIG_FILE, HttpService:JSONEncode(data)) end
end
local config = loadConfig()
local AutoAcceptEnabled = config.AutoAcceptEnabled
local MAX_FRIENDS = 200

-- ===============================
-- Anti AFK
-- ===============================
local AntiAFKEnabled = true
LocalPlayer.Idled:Connect(function()
    if AntiAFKEnabled then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- Chat AntiAFK mỗi 60s
task.spawn(function()
    while task.wait(60) do
        if AntiAFKEnabled then
            game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
                "[System] Chức năng Anti AFK đang vận hành bởi Hoàng Quân",
                "All"
            )
        end
    end
end)

-- ===============================
-- UI Chính
-- ===============================
local screenGui = Instance.new("ScreenGui", PlayerGui)
screenGui.Name = "VN_Info_HUD"
screenGui.ResetOnSpawn = false

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 240, 0, 120)
frame.Position = UDim2.new(1, -250, 0, 10)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

-- Hàm tạo label
local function createLabel(y, text, color)
    local l = Instance.new("TextLabel", frame)
    l.Size = UDim2.new(1, -10, 0, 14)
    l.Position = UDim2.new(0, 5, 0, y)
    l.BackgroundTransparency = 1
    l.TextColor3 = color
    l.TextStrokeTransparency = 0.6
    l.Font = Enum.Font.Gotham
    l.TextSize = 12
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.Text = text
    return l
end

-- Labels
local clockLabel   = createLabel(5,  "⏰ VN: --:--:--", Color3.new(1,1,1))
local dateLabel    = createLabel(22, "📅 --/--/----", Color3.fromRGB(180,220,255))
local nameLabel    = createLabel(39, "👤 User: " .. LocalPlayer.DisplayName, Color3.fromRGB(255,215,0))
local serverLabel  = createLabel(56, "🎮 Sea: ??? | 🤼 Players: --", Color3.fromRGB(150,255,150))
local perfLabel    = createLabel(73, "⚡ FPS: --", Color3.fromRGB(255,200,0))
local friendCount  = createLabel(90, "🤝 Friends: --/200", Color3.fromRGB(0,200,255))

-- ===============================
-- Settings Panel
-- ===============================
local settingsFrame = Instance.new("Frame", screenGui)
settingsFrame.Size = UDim2.new(0, 180, 0, 160)
settingsFrame.Position = UDim2.new(1, -190, 0, 140)
settingsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
settingsFrame.Visible = false
Instance.new("UICorner", settingsFrame).CornerRadius = UDim.new(0,8)

local function createBtn(parent, y, text, color)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(1, -20, 0, 22)
    btn.Position = UDim2.new(0,10,0,y)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 12
    btn.TextColor3 = Color3.new(1,1,1)
    btn.BackgroundColor3 = color
    btn.Text = text
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
    return btn
end

-- Clear Cache
local clearBtn = createBtn(settingsFrame, 10, "🧹 Clear Cache", Color3.fromRGB(100,100,200))
clearBtn.MouseButton1Click:Connect(function()
    collectgarbage("collect")
    clearBtn.Text = "✅ Cache Cleared"
    task.delay(2, function() clearBtn.Text = "🧹 Clear Cache" end)
end)

-- Anti Ban / Anti RedFlag / Anti Kick
local antiBan, antiRF, antiKick = false,false,false
local banBtn   = createBtn(settingsFrame, 40, "🛡 Anti Ban: OFF", Color3.fromRGB(150,50,50))
local rfBtn    = createBtn(settingsFrame, 70, "🛡 Anti RedFlag: OFF", Color3.fromRGB(150,50,50))
local kickBtn  = createBtn(settingsFrame,100, "🛡 Anti Kick: OFF", Color3.fromRGB(150,50,50))

local function toggle(btn, state, label)
    if state then
        btn.Text = label .. ": ON"
        btn.BackgroundColor3 = Color3.fromRGB(50,150,50)
    else
        btn.Text = label .. ": OFF"
        btn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    end
end

banBtn.MouseButton1Click:Connect(function() antiBan=not antiBan toggle(banBtn,antiBan,"🛡 Anti Ban") end)
rfBtn.MouseButton1Click:Connect(function() antiRF=not antiRF toggle(rfBtn,antiRF,"🛡 Anti RedFlag") end)
kickBtn.MouseButton1Click:Connect(function() antiKick=not antiKick toggle(kickBtn,antiKick,"🛡 Anti Kick") end)

-- ===============================
-- Gear Button mở Settings
-- ===============================
local gearBtn = Instance.new("TextButton", frame)
gearBtn.Size = UDim2.new(0, 20, 0, 20)
gearBtn.Position = UDim2.new(1, -25, 0, 5)
gearBtn.Text = "⚙"
gearBtn.Font = Enum.Font.Gotham
gearBtn.TextSize = 12
gearBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
gearBtn.TextColor3 = Color3.new(1,1,1)
gearBtn.MouseButton1Click:Connect(function()
    settingsFrame.Visible = not settingsFrame.Visible
end)

-- ===============================
-- Update thông tin
-- ===============================
local function getSea()
    local id = game.PlaceId
    if id==2753915549 then return "First Sea"
    elseif id==4442272183 then return "Second Sea"
    elseif id==7449423635 then return "Third Sea"
    else return "Unknown" end
end

task.spawn(function()
    while task.wait(1) do
        local now=os.date("!*t")
        local vnHour=(now.hour+7)%24
        clockLabel.Text="⏰ VN: "..string.format("%02d:%02d:%02d",vnHour,now.min,now.sec)
        dateLabel.Text="📅 "..string.format("%02d/%02d/%04d",now.day,now.month,now.year)
        serverLabel.Text="🎮 "..getSea().." | 🤼 Players: "..#Players:GetPlayers()
        friendCount.Text="🤝 Friends: "..#Players:GetPlayers().."/200"
    end
end)

local fps,last=0,tick()
RunService.RenderStepped:Connect(function()
    fps+=1
    if tick()-last>=1 then
        perfLabel.Text="⚡ FPS: "..fps
        fps,last=0,tick()
    end
end)
