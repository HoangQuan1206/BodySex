-- ===============================
-- HUD VN + Auto Accept Friend + Anti AFK (Fix + NÃ¢ng cáº¥p)
-- ===============================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")

-- XÃ³a HUD cÅ©
if PlayerGui:FindFirstChild("VN_Info_HUD") then
    PlayerGui.VN_Info_HUD:Destroy()
end

-- ===============================
-- Config (chá»‰ lÆ°u AutoAccept)
-- ===============================
local CONFIG_FILE = "VN_HUD_Config.json"
local function loadConfig()
    if isfile and isfile(CONFIG_FILE) then
        local ok, data = pcall(function() return HttpService:JSONDecode(readfile(CONFIG_FILE)) end)
        if ok and data then return data end
    end
    return {AutoAcceptEnabled = true}
end
local function saveConfig(data)
    if writefile then writefile(CONFIG_FILE, HttpService:JSONEncode(data)) end
end
local config = loadConfig()
local AutoAcceptEnabled = config.AutoAcceptEnabled
local MAX_FRIENDS = 200

-- ===============================
-- Auto Accept Friend
-- ===============================
local function acceptFriend(player)
    if not AutoAcceptEnabled then return end
    if not player or player == LocalPlayer then return end
    if #LocalPlayer:GetFriendsOnline() >= MAX_FRIENDS then
        warn("[FriendSystem] Friend list full (200/200).")
        return
    end
    pcall(function()
        LocalPlayer:RequestFriendship(player)
        player:RequestFriendship(LocalPlayer)
        print("[FriendSystem] Accepted:", player.Name)
    end)
end
Players.PlayerAdded:Connect(acceptFriend)
for _, p in pairs(Players:GetPlayers()) do acceptFriend(p) end

-- ===============================
-- Anti AFK (luÃ´n báº­t khi cháº¡y)
-- ===============================
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
    print("[System] Anti AFK: Prevented kick.")
end)

-- ===============================
-- UI ChÃ­nh
-- ===============================
local screenGui = Instance.new("ScreenGui", PlayerGui)
screenGui.Name = "VN_Info_HUD"
screenGui.ResetOnSpawn = false

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 280, 0, 160)
frame.Position = UDim2.new(1, -290, 0, 10)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
frame.BackgroundTransparency = 0.15
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

-- HÃ m táº¡o label
local function createLabel(y, text, size, color, bold)
    local l = Instance.new("TextLabel", frame)
    l.Size = UDim2.new(1, -10, 0, 20)
    l.Position = UDim2.new(0, 5, 0, y)
    l.BackgroundTransparency = 1
    l.TextColor3 = color
    l.TextStrokeTransparency = 0.6
    l.Font = bold and Enum.Font.GothamBold or Enum.Font.Gotham
    l.TextSize = size
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.Text = text
    return l
end

-- Labels
local clockLabel = createLabel(5, "â° VN: --:--:--", 20, Color3.new(1,1,1), true)
local dateLabel = createLabel(30, "ðŸ“… --/--/----", 18, Color3.fromRGB(180,220,255))
local nameLabel = createLabel(50, "ðŸ‘¤ User: " .. LocalPlayer.DisplayName .. "(@" .. LocalPlayer.Name .. ")", 16, Color3.fromRGB(255,215,0))
local serverLabel = createLabel(70, "ðŸŽ® Sea: ??? | ðŸ¤¼ Players: --", 16, Color3.fromRGB(150,255,150))
local perfLabel = createLabel(90, "âš¡ FPS: -- | ðŸ“¡ Ping: --", 16, Color3.fromRGB(255,200,0))
local friendCount = createLabel(110, "ðŸ¤ Friends: --/200", 16, Color3.fromRGB(0,200,255))

-- Button Auto Accept
local autoBtn = Instance.new("TextButton", frame)
autoBtn.Size = UDim2.new(0, 260, 0, 25)
autoBtn.Position = UDim2.new(0, 10, 0, 135)
autoBtn.Font = Enum.Font.GothamBold
autoBtn.TextSize = 16
autoBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", autoBtn).CornerRadius = UDim.new(0,8)

local function updateAutoBtn()
    if AutoAcceptEnabled then
        autoBtn.Text = "ðŸ¤ Auto Accept Friend: ON"
        autoBtn.BackgroundColor3 = Color3.fromRGB(40,150,40)
    else
        autoBtn.Text = "ðŸ¤ Auto Accept Friend: OFF"
        autoBtn.BackgroundColor3 = Color3.fromRGB(150,40,40)
    end
end
updateAutoBtn()

autoBtn.MouseButton1Click:Connect(function()
    AutoAcceptEnabled = not AutoAcceptEnabled
    config.AutoAcceptEnabled = AutoAcceptEnabled
    saveConfig(config)
    updateAutoBtn()
end)

-- ===============================
-- UI Settings
-- ===============================
local settingsFrame = Instance.new("Frame", screenGui)
settingsFrame.Size = UDim2.new(0, 200, 0, 100)
settingsFrame.Position = UDim2.new(1, -210, 0, 180)
settingsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
settingsFrame.Visible = false
Instance.new("UICorner", settingsFrame).CornerRadius = UDim.new(0,8)

local copyBtn = Instance.new("TextButton", settingsFrame)
copyBtn.Size = UDim2.new(1, -20, 0, 30)
copyBtn.Position = UDim2.new(0,10,0,10)
copyBtn.Text = "ðŸ“‹ Copy JobID"
copyBtn.BackgroundColor3 = Color3.fromRGB(50,50,150)
copyBtn.TextColor3 = Color3.new(1,1,1)

copyBtn.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(game.JobId)
        copyBtn.Text = "âœ… Copied!"
        task.delay(2, function() copyBtn.Text = "ðŸ“‹ Copy JobID" end)
    end
end)

local hopBtn = Instance.new("TextButton", settingsFrame)
hopBtn.Size = UDim2.new(1, -20, 0, 30)
hopBtn.Position = UDim2.new(0,10,0,50)
hopBtn.Text = "ðŸ”„ Hop Server (rejoin)"
hopBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
hopBtn.TextColor3 = Color3.new(1,1,1)

hopBtn.MouseButton1Click:Connect(function()
    print("[System] Hopping server...")
    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end)

local gearBtn = Instance.new("TextButton", frame)
gearBtn.Size = UDim2.new(0, 25, 0, 25)
gearBtn.Position = UDim2.new(1, -30, 0, 5)
gearBtn.Text = "âš™"
gearBtn.BackgroundTransparency = 0.3
gearBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
gearBtn.TextColor3 = Color3.new(1,1,1)

gearBtn.MouseButton1Click:Connect(function()
    settingsFrame.Visible = not settingsFrame.Visible
end)

-- ===============================
-- Thu gá»n HUD
-- ===============================
local miniBtn = Instance.new("TextButton", screenGui)
miniBtn.Size = UDim2.new(0, 40, 0, 40)
miniBtn.Position = frame.Position
miniBtn.Text = "ðŸ„"
miniBtn.TextSize = 28
miniBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
miniBtn.TextColor3 = Color3.new(1,1,1)
miniBtn.Visible = false

local function toggleHUD()
    if frame.Visible then
        frame.Visible = false
        settingsFrame.Visible = false
        miniBtn.Visible = true
    else
        frame.Visible = true
        miniBtn.Visible = false
    end
end
miniBtn.MouseButton1Click:Connect(toggleHUD)

UserInputService.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.F4 then
        toggleHUD()
    end
end)

-- ===============================
-- Update thÃ´ng tin
-- ===============================
local function getSea()
    local id = game.PlaceId
    if id==2753915549 then return "First Sea"
    elseif id==4442272183 then return "Second Sea"
    elseif id==7449423635 then return "Third Sea"
    else return "Unknown" end
end

task.spawn(function()
    while task.wait(1) do
        local now=os.date("!*t")
        local vnHour=(now.hour+7)%24
        clockLabel.Text="â° VN: "..string.format("%02d:%02d:%02d",vnHour,now.min,now.sec)
        dateLabel.Text="ðŸ“… "..string.format("%02d/%02d/%04d",now.day,now.month,now.year)
        serverLabel.Text="ðŸŽ® "..getSea().." | ðŸ¤¼ Players: "..#Players:GetPlayers()
        friendCount.Text="ðŸ¤ Friends: "..#Players:GetPlayers().."/200"
    end
end)

local fps,last=0,tick()
RunService.RenderStepped:Connect(function()
    fps+=1
    if tick()-last>=1 then
        local ping=game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString()
        perfLabel.Text="âš¡ FPS: "..fps.." | ðŸ“¡ Ping: "..ping
        fps,last=0,tick()
    end
end)
